{% extends "base.html" %}

{% block content %}

<div style="max-width:1100px;margin:auto;padding:20px;">

    <h2>Orders (Shopkeeper)</h2>

    {% if orders %}
    <table border="1" width="100%" cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
                <th>Update</th>
            </tr>
        </thead>

        <tbody>
        {% for order in orders %}
            <tr>
                <td>#{{ order.id }}</td>

                <td>{{ order.user.email }}</td>

                <!-- ✅ FINAL PAYABLE AMOUNT -->
                <td>
                    ₹{{ order.final_total|floatformat:2 }}
                    <br>
                    <small>
                        Items: {{ order.total_items }} |
                        Discount: ₹{{ order.discount_amount|floatformat:2 }}
                    </small>
                </td>

                <td>{{ order.get_status_display }}</td>

                <td>
                    <form method="post" action="{% url 'update_order_status' order.id %}">
                        {% csrf_token %}
                        <select name="status">
                            {% for key,label in order.STATUS_CHOICES %}
                                <option value="{{ key }}"
                                    {% if order.status == key %}selected{% endif %}
                                >
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
        <p>No orders found.</p>
    {% endif %}

</div>

{% endblock %}
